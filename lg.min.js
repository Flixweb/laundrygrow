(function () {
    const navbar = document.getElementById('mainNavbar');
    const threshold = 20;
    let ticking = false;

    function onScroll() {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                if (window.scrollY > threshold) {
                    navbar.classList.add('navbar-scrolled');
                } else {
                    navbar.classList.remove('navbar-scrolled');
                }
                ticking = false;
            });
            ticking = true;
        }
    }

    window.addEventListener('scroll', onScroll);
})();


function createAnimatedElements() {
    const heroBackground = document.querySelector('.hero-background');
    const fragment = document.createDocumentFragment();


    for (let i = 0; i < 5; i++) {
        const size = Math.random() * 60 + 40;
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.style.width = bubble.style.height = `${size}px`;
        bubble.style.left = `${Math.random() * 100}%`;
        bubble.style.top = `${Math.random() * 100}%`;
        bubble.style.animationDelay = `${Math.random() * 5}s`;
        fragment.appendChild(bubble);
    }


    const icons = ['tshirt', 'socks', 'mitten', 'vest', 'hat-cowboy', 'bucket'];
    for (let i = 0; i < 8; i++) {
        const icon = document.createElement('i');
        icon.className = `laundry-icon fas fa-${icons[Math.floor(Math.random() * icons.length)]}`;
        icon.style.fontSize = `${Math.random() * 15 + 15}px`;
        icon.style.left = `${Math.random() * 100}%`;
        icon.style.top = `${Math.random() * 100}%`;
        icon.style.animationDelay = `${Math.random() * 10}s`;
        icon.style.animationDuration = `${Math.random() * 10 + 15}s`;
        fragment.appendChild(icon);
    }


    for (let i = 0; i < 50; i++) {
        const size = Math.random() * 20 + 10;
        const bubble = document.createElement('div');
        bubble.className = 'soap-bubble';
        bubble.style.width = bubble.style.height = `${size}px`;
        bubble.style.left = `${Math.random() * 100}%`;
        bubble.style.bottom = `-${size}px`;
        bubble.style.animationDelay = `${Math.random() * 8}s`;
        bubble.style.animationDuration = `${Math.random() * 5 + 10}s`;
        fragment.appendChild(bubble);
    }

    heroBackground.appendChild(fragment); // single append â†’ single reflow
}


document.addEventListener('DOMContentLoaded', createAnimatedElements);

// --- Smooth scroll fix for fixed navbar ---
(function () {
    const navbar = document.getElementById('mainNavbar');
    const NAVBAR_HEIGHT = navbar.offsetHeight || 72;
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            if (!href || href === '#' || href === '#!') return;
            const targetEl = document.querySelector(href);
            if (targetEl) {
                e.preventDefault();
                const absoluteTop = targetEl.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({
                    top: absoluteTop - NAVBAR_HEIGHT - 14,
                    behavior: 'smooth'
                });

                const bsCollapseEl = document.getElementById('navCollapse');
                if (bsCollapseEl && bsCollapseEl.classList.contains('show')) {
                    const collapseInstance = bootstrap.Collapse.getInstance(bsCollapseEl);
                    if (collapseInstance) collapseInstance.hide();
                }
            }
        });
    });
})();

(function () {
    const planButtons = document.querySelectorAll('.choose-plan');
    const modalEl = document.getElementById('planModal');
    const modalTitle = document.getElementById('planModalLabel');
    const modalBody = document.getElementById('planModalBody');
    const bsModal = new bootstrap.Modal(modalEl);

    planButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const plan = btn.getAttribute('data-plan') || 'Plan';
            modalTitle.textContent = `Sign Up for ${plan}`;
            modalBody.innerHTML = `
                <p>Thank you for choosing the <strong>${plan}</strong> plan!</p>
                <p class="mb-0">Enter your details on the signup page to start your free trial. A friendly onboarding specialist will reach out to help you get set up.</p>
            `;
            bsModal.show();
        });
    });
})();


(function () {
    const form = document.getElementById('contactForm');
    const alertEl = document.getElementById('contactAlert');
    form.addEventListener('submit', function (e) {
        e.preventDefault();
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        setTimeout(() => {
            form.reset();
            alertEl.classList.remove('d-none');
            submitBtn.disabled = false;
            setTimeout(() => alertEl.classList.add('d-none'), 4500);
        }, 700);
    });
})();

(function () {
    const showPage1 = document.getElementById('showPage1');
    const showPage2 = document.getElementById('showPage2');
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');

    if (showPage1 && showPage2 && page1 && page2) {
        showPage1.addEventListener('click', () => {
            page1.style.display = 'block';
            page2.style.display = 'none';
            showPage1.classList.add('active');
            showPage2.classList.remove('active');
        });

        showPage2.addEventListener('click', () => {
            page1.style.display = 'none';
            page2.style.display = 'block';
            showPage2.classList.add('active');
            showPage1.classList.remove('active');
        });
    }
})();

document.getElementById('year').textContent = new Date().getFullYear();

// --- Accessibility: highlight nav links on scroll ---
(function () {
    const sections = Array.from(document.querySelectorAll('section, header')).filter(s => s.id);
    let ticking = false;

    function updateActiveSection() {
        const scrollPos = window.scrollY + (document.getElementById('mainNavbar').offsetHeight || 72) + 24;
        let current = sections[0] ? sections[0].id : null;
        for (const sec of sections) {
            if (sec.offsetTop <= scrollPos) current = sec.id;
        }
        document.querySelectorAll('.navbar .nav-link').forEach(link => {
            const href = link.getAttribute('href') || '';
            if (href === '#' + current) {
                link.classList.add('active');
                link.setAttribute('aria-current', 'page');
            } else {
                link.classList.remove('active');
                link.removeAttribute('aria-current');
            }
        });
    }

    function onScroll() {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                updateActiveSection();
                ticking = false;
            });
            ticking = true;
        }
    }

    window.addEventListener('scroll', onScroll);
    window.addEventListener('load', updateActiveSection);
})();

(function () {
    const fadeElements = document.querySelectorAll('.fade-in');
    let ticking = false;

    function checkFade() {
        fadeElements.forEach(el => {
            const rect = el.getBoundingClientRect();
            if (rect.top < window.innerHeight - 150) el.classList.add('visible');
        });
    }

    function onScroll() {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                checkFade();
                ticking = false;
            });
            ticking = true;
        }
    }

    window.addEventListener('scroll', onScroll);
    window.addEventListener('load', checkFade);
})();

(function () {
    const style = document.createElement('style');
    style.textContent = `
        .bg-light-purple { background-color: var(--light-purple); }
        .text-purple { color: var(--primary-purple); }
        .bg-light-primary { background-color: rgba(138, 79, 255, 0.05); }
        .feature-icon-sm { width: 48px; height: 48px; flex-shrink: 0; }
        .border-primary { border-color: var(--primary-purple) !important; }
    `;
    document.head.appendChild(style);
})();

document.querySelectorAll('.faq-question').forEach(question => {
    question.addEventListener('click', () => {
        question.parentElement.classList.toggle('faq-active');
    });
});

(function () {
    const pricingToggle = document.getElementById('pricing-toggle');
    const monthlyLabel = document.getElementById('monthly-label');
    const yearlyLabel = document.getElementById('yearly-label');
    const monthlyPrices = document.querySelectorAll('.monthly-price');
    const yearlyPrices = document.querySelectorAll('.yearly-price');

    if (!pricingToggle) return;

    pricingToggle.addEventListener('change', function () {
        const isYearly = this.checked;
        monthlyLabel.classList.toggle('active', !isYearly);
        yearlyLabel.classList.toggle('active', isYearly);
        monthlyPrices.forEach(el => el.classList.toggle('d-none', isYearly));
        yearlyPrices.forEach(el => el.classList.toggle('d-none', !isYearly));
    });
})();
